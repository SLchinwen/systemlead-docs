# e首發票｜發票開立與取號治理規則

> 檔案路徑：`docs/rules/einv/invoice-issuance-and-numbering.md`
> 
> 文件角色：**Rules（SSOT）**
> 
> 本文件為 e首發票關於「發票開立、取號責任、機台追蹤、混合使用與切本配號」之**唯一事實來源**，供 API、操作手冊、SOP、客服與 AI 服務引用，不得於其他文件重複定義。

---

## 1. 文件目的與適用範圍

本規則用於統一界定下列事項：

1. 發票版與訂單版開立模式之**取號責任歸屬**
2. 機台／繳款設備之**機台號追蹤治理原則**
3. 多來源同時開立發票之**混合使用治理要求**
4. e首發票「切本配號管理」之**正式定位與使用規範**

本規則適用於：

- e首發票所有「開立發票 API」
- ERP / POS / 電商平台 / 機台設備串接情境
- 後台人工補登、EXCEL 匯入等補開流程

---

## 2. 名詞定義

| 名詞 | 定義 |
|---|---|
| 發票版（Invoice-based） | 由外部系統自行管理並傳入發票號碼的開立模式 |
| 訂單版（Order-based） | 發票號碼由 e首發票系統協助取號的開立模式 |
| 取號責任 | 指對發票號碼正確性、連續性與不重複之最終責任歸屬 |
| 混合使用 | 同一營業人同時使用多個來源或模式開立發票 |
| 切本 | 將同一期字軌依用途分割為多組可獨立取號的號碼範圍 |
| 機台號 | 用於識別無人設備或繳款設備來源之唯一識別碼 |

---

## 3. 發票版（Invoice-based）取號責任規則

### 3.1 取號責任歸屬

- 發票號碼**必須由呼叫端系統自行管理並傳入**，包含但不限於：
  - ERP 系統
  - 前端 POS 系統
  - 具備發票號治理能力之自建系統

- e首發票於此模式下：
  - 不負責發票號碼之分配、補號或修正
  - 僅負責資料合法性檢核、上傳存證與後續處理

### 3.2 必要治理條件

使用發票版模式，呼叫端系統**必須同時具備**：

1. 字軌控管能力
2. 發票號碼序時不跳號能力
3. 重號防護與例外處理機制

> 未具備上述能力者，不建議使用發票版模式。

---

## 4. 訂單版（Order-based）取號責任規則

### 4.1 取號責任歸屬

- 發票號碼可由 **e首發票系統協助取號**
- 呼叫端僅需提供：
  - 訂單識別（如訂單編號）
  - 買受人資訊
  - 金額與稅別資料

- e首發票負責：
  - 依切本規則自動配號
  - 確保序時序號正確
  - 避免跳號與重號風險

### 4.2 適用原則

訂單版模式適用於：

- 電商平台
- 訂單可能取消、延遲或退貨
- 不希望自行承擔取號治理風險之營業人

---

## 5. 機台／繳款設備之機台號追蹤規則

### 5.1 情境定義

本規則適用於：

- 自助販賣機
- 繳費機
- 無人或半無人交易設備

### 5.2 機台號治理原則

1. 每一台設備**必須具備唯一機台號**
2. 機台號須可對應：
   - 發票開立來源
   - 場域或設備位置
3. 機台號應納入發票資料之可稽核欄位（如備註或擴充欄位）

### 5.3 取號策略

- 機台設備原則上：
  - 由 e首發票協助取號
  - 採用簡化且固定的開立邏輯

---

## 6. 混合使用治理規則（關鍵）

### 6.1 混合使用定義

同一營業人，同時存在以下任一情境，即屬混合使用：

- ERP 與 POS 同時開立發票
- ERP / POS 與電商平台並行
- 系統開立與機台設備並行

### 6.2 禁止事項

以下情境**嚴格禁止**：

1. 多個來源共用同一組未切本之發票號碼
2. 未經治理直接同時取號
3. 發票號責任歸屬不明確

---

## 7. 切本配號管理規則（正式定位）

### 7.1 切本目的

切本配號管理用於：

- 支援多來源同時開立
- 明確界定責任歸屬
- 降低重號與跳號風險

### 7.2 建議切本策略

| 用途 | 說明 |
|---|---|
| ERP 本 | 由 ERP 系統自行取號 |
| POS 本 | 由 POS 系統自行取號 |
| 電商本 | 由 e首發票協助取號（訂單版） |
| 機台本 | 由 e首發票協助取號（機台模式） |

### 7.3 治理要求

- 每一本切本僅能對應**一種取號責任模式**
- 切本用途需可被稽核與追溯

---

## 8. 治理警語（必須揭露）

> 是否由 e首發票協助取號，並非技術選項，而是**責任歸屬與風險治理的選擇**。
> 
> 營業人應依自身系統成熟度，選擇適合之開立模式，並妥善規劃切本配號。

---

## 9. 本規則之引用與變更原則

- 本文件為 SSOT，其他文件僅能引用，不得重新定義
- 如規則異動：
  1. 先更新本文件
  2. 再調整 API 說明 / SOP / KB
  3. 視影響範圍新增 Release 公告

