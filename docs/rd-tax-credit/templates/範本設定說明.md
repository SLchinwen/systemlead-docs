# ref.docx 範本設定說明（排版、標題、縮排、表格框線）

本說明讓大家能依**政府附件1-研發計畫重點摘要書**的排版、標題、縮排建立共用範本。

---

## 可以直接用原檔當範本嗎？

**可以。** 把政府提供的「附件1-研發計畫重點摘要書(中小企業).docx」**直接**複製到本目錄並命名為 **ref.docx** 即可，**不必先做任何 Word 設定**。Pandoc 會套用該檔的標題、內文、縮排等樣式。

若**轉出後發現字型排列與 ref.docx 不同、或表格沒有框線**，請依下方 **「二、產出與 ref.docx 不同時：字型排列與表格框線」** 在 Word 裡調整 ref.docx 的樣式（標題／內文字型、表格框線）後儲存，再重新轉出即可。

---

## 項次編號要不要對照範本重做？

**目前不必。** 計畫書的 Markdown（`plans/2025/2025_年度研發投資抵減_完整計畫書.md`）已依政府計畫格式範本（`templates/年度研發投資抵減計畫書（政府計畫格式）.md`）撰寫，項次為：

- 章：**一、二、三 … 十、附錄**
- 第六章子項：**（一）（二）（三）（四）**

與政府常用格式一致，**不需重新產生項次編號**。轉出 DOCX 時，Pandoc 會沿用 Markdown 標題文字（含「一、」「二、」等），並套用 ref.docx 的字型與段落樣式。

若您手上的 **ref.docx（附件1）** 使用不同編號（例如壹貳參、或 1. 2. 3.）：

- **做法 A**：在 Word 開啟 ref.docx，將「標題 1／標題 2」的大綱編號設成「一、二、三…」與「（一）（二）…」，儲存後轉出即會一致。
- **做法 B**：若希望 MD 完全配合 Word 的編號，請告訴我們 ref.docx 實際使用的項次格式，再依該格式調整 Markdown 標題。

---

## 一、建立 ref.docx（第一次設定）

### 方式 A：用腳本複製（建議）

1. 確認政府提供的檔案路徑，例如：  
   `C:\Users\sl-ch\OneDrive - SystemLead Tech CO\文件\附件1-研發計畫重點摘要書(中小企業)(1).docx`
2. 若路徑不同，用編輯器開啟 **`docs\rd-tax-credit\Setup-RefTemplate.ps1`**，修改裡面的 `$sourcePath`。
3. 在 PowerShell 於**專案根目錄**執行：
   ```powershell
   .\docs\rd-tax-credit\Setup-RefTemplate.ps1
   ```
   腳本會把該檔案複製到 `docs\rd-tax-credit\templates\ref.docx`。

### 方式 B：手動複製

1. 將 **附件1-研發計畫重點摘要書(中小企業).docx** 複製到 `docs\rd-tax-credit\templates\`。
2. 重新命名為 **`ref.docx`**。

---

## 二、產出與 ref.docx 不同時：字型排列與表格框線

若轉出的 DOCX **字型排列與 ref.docx 不同**、或**表格沒有框線**，代表 Pandoc 套用的樣式與 ref.docx 不一致。請在 Word 裡**手動調整 ref.docx 的樣式**後再存檔，然後重新執行 輸出DOCX.bat。

### 2.1 讓字型、段落與 ref.docx 一致

Pandoc 會套用 ref.docx 中 **標題 1、標題 2、標題 3、內文（正文）** 等樣式的字型、大小、行距。請在 Word 中：

1. 開啟 **ref.docx**。
2. **常用** → **樣式**（或 **樣式** 窗格）→ 找到 **標題 1**、**標題 2**、**內文**（或 **正文**）。
3. 在每個樣式上**右鍵 → 修改**，設定您要的字型、字級、行距、與前後段距離，使版面與政府格式一致。
4. 若政府附件1 的標題／內文已用這些樣式，理論上不需改；若附件1 用的是「手動」格式而非樣式，請先將 ref.docx 內一段標題、一段內文**套用「標題 1」「內文」樣式**，再修改該樣式，這樣 Pandoc 轉出時才會套用。
5. **儲存** ref.docx。

### 2.2 讓表格有框線（與 ref.docx 一致）

**重要**：Pandoc 只會套用 ref.docx 裡**「第一個」出現的表格**的樣式。若第一個表格沒有框線，或檔案裡根本沒有表格，轉出的表格就不會有框線。

請在 Word 中依下列**任選一種**方式操作，並確保「有框線的那個表格」是 ref.docx 的**第一個表格**：

**方式 A：ref.docx 裡已有表格**

1. 開啟 **ref.docx**。
2. 找到**第一個**表格（從文件開頭算起）。若有多個表格，待會要讓「有框線的」變成第一個。
3. 點選該表格 → **表格設計**（或 **表格工具**）→ **框線** → 選 **「全部框線」**（或 **外框線 + 內框線**）。
4. 同一表格 → **表格設計** → **表格樣式** → 選 **「表格格線」**（Table Grid）或 **「網格表」**。
5. **若文件中還有其他表格在更前面**：請把「已設好框線」的這個表格**剪下**，貼到文件**最上方**（標題之前或緊接標題之後），讓它成為整份文件的第一個表格。
6. **儲存** ref.docx 後關閉。

**方式 B：ref.docx 裡沒有表格，或希望用一個乾淨的表格當樣式**

1. 開啟 **ref.docx**。
2. 將游標移到**文件最開頭**（標題之前）。
3. **插入** → **表格** → 插入 **2 列 × 2 欄** 小表格。
4. 點選該表格 → **表格設計** → **框線** → **全部框線**。
5. **表格樣式** 選 **「表格格線」**（Table Grid）。
6. 若不需要這張示範表佔版面，可將表格內容清空、或將列高縮到很小，只保留樣式即可。
7. **儲存** ref.docx 後關閉。

**若第一頁已有表格和框線，但轉出仍沒有框線**：  
Pandoc 是依 Word 檔案**內部順序**取「第一個表格」的樣式，有時與肉眼看到的第一頁不同（例如有隱藏表格、或本文前有其他物件）。請**在 ref.docx 最開頭**（標題或任何內容之前）**手動插入**一個新的 2×2 小表格 → 設**全部框線**＋**表格格線**樣式 → **儲存**。這樣可確保「第一個表格」一定是帶框線的，轉出就會套用。

**若仍沒有框線**：請確認 (1) ref.docx 存檔後有關閉再轉檔；(2) 有框線的表格確實在 ref.docx 中是**第一個**表格（用 Word「尋找」搜尋表格或從頭捲動檢查）；(3) 該表格已套用「表格格線」或「全部框線」。

完成上述後，重新執行 **輸出DOCX.bat**，產出的表格應會出現框線。

### 2.3 若轉出「還是沒有框線、字型也不同」：檢查清單

請依序確認並修正 ref.docx，**每改一項就儲存 ref.docx、關閉檔案，再執行一次 輸出DOCX.bat** 測試。

**字型不同**

1. 在 ref.docx 中，政府格式若為 **標楷體**（或特定字型），請在 **樣式** 裡修改：
   - **內文**（或 **正文** / Normal）：右鍵 → 修改 → 字型選與政府附件相同的字型（如 標楷體）、字級，按確定。
   - **標題 1**、**標題 2**：同樣右鍵 → 修改 → 字型、字級設成與 ref 版面一致。
2. 若 ref 裡的文字是「手動」格式（沒套用樣式），Pandoc 不會用到：請在 ref.docx 中**選取一段標題** → 套用 **標題 1**；**選取一段內文** → 套用 **內文**，再依上一步「修改」該樣式的字型。儲存後轉出才會跟 ref 字型一致。

**表格還是沒有框線**

1. 確認 ref.docx 路徑是 **`docs\rd-tax-credit\templates\ref.docx`**（與 Export-Docx.ps1 使用的一致）。
2. 在 ref.docx 中，**從文件最開頭**（Ctrl+Home）算起，**第一個**表格必須有框線：
   - 點選該表格 → **表格設計** → **框線** → **全部框線**；**表格樣式** → **表格格線**。
   - 若第一段是標題、下面才是表格，沒關係，只要「第一個表格」有框線即可。
3. 若仍不確定哪個是第一個：在 ref 最上方**新增**一個 2×2 小表格，設**全部框線**＋**表格格線**，儲存。這樣 Pandoc 一定會套到有框線的表格。

**仍無效時**

- 確認轉檔時 ref.docx **已關閉**（未在 Word 中開啟）。
- 確認 輸出DOCX.bat 是從 **專案根目錄** 或 **rd-tax-credit 資料夾** 執行，路徑才會正確找到 ref.docx。

---

## 三、給大家參照使用

- **範本檔案**：就是 **`templates\ref.docx`**（由附件1 複製並依上面步驟設定框線後存檔）。
- **下載／取得方式**：
  - 若 ref.docx 已放入 repo：其他人 clone 或 pull 後即有範本，直接執行 輸出DOCX.bat 即可。
  - 若 ref.docx 不進版控（例如含個資）：請每位同仁依「一、二」自行用自己電腦的附件1 跑一次 Setup-RefTemplate.ps1，再在 Word 裡設定表格框線後存檔。

---

## 四、參考路徑整理

| 項目 | 路徑或檔名 |
|------|------------|
| 範本檔（程式用） | `docs\rd-tax-credit\templates\ref.docx` |
| 設定腳本 | `docs\rd-tax-credit\Setup-RefTemplate.ps1` |
| 轉出 DOCX | 雙擊 `docs\rd-tax-credit\輸出DOCX.bat`，產出在 `docx-output\` |

---

👉 若希望「每一份」轉出的 DOCX 都套用 ref.docx，可編輯 **`docx-file-list.txt`**，在要套用的那一行第三欄加上 `ref`。
