# e首發票｜開立發票 API 使用情境總覽（Scenarios）

> 檔案建議路徑：`docs/modules/einv/api/scenarios.md`
>
> 文件角色：**API 情境導引（非 SSOT）**
>
> 本文件用於協助工程師、營業人、客服與 AI **快速選擇正確的開立發票 API 使用情境**。
> 
> 所有「取號責任、混合使用與切本配號」之正式定義，請以以下規則文件為準（SSOT）：
>
> - `docs/rules/einv/invoice-issuance-and-numbering.md`

---

## 一、我該用哪一種開立情境？（三秒判斷）

請先回答以下三個問題：

1. **發票號碼是否由我的系統自行管理？**
2. **是否需要即時開立並可能立即列印？**
3. **是否為訂單、平台或無人設備情境？**

對照下表即可快速選擇。

---

## 二、開立發票 API 情境總覽表

| 情境代號 | 情境名稱 | 主要資料來源 | 取號責任 | 是否即時開立 | 是否支援雲端列印 | 適用對象 |
|---|---|---|---|---|---|---|
| A | 發票版（Invoice-based） | ERP / POS | 營業人系統 | 是 | 是 | ERP、POS、櫃台系統 |
| B | 訂單版（Order-based） | 訂單系統 | e首發票 | 視條件 | 否（原則） | 電商平台、訂單系統 |
| C | 平台整合型 | 平台 API / Webhook | e首發票 | 否（排程） | 否 | Shopee、Woo、91APP |
| D | 第三方轉入後補開 | 第三方資料 | e首發票（轉換後） | 否 | 否 | 金流/未簽約平台 |
| E | 人工／EXCEL 補登 | 人工或檔案 | 視設定 | 否 | 視需求 | 異常/補開情境 |
| F | 機台／繳款設備 | 無人設備 | e首發票 | 是（簡化） | 否（多數） | 販賣機、繳費機 |

---

## 三、各情境說明

### 情境 A｜發票版（Invoice-based）

**一句話說明**：
> 發票號碼由你的系統決定，e首發票負責合規與上傳。

- 取號責任：營業人（ERP / POS）
- 特點：
  - 即時開立
  - 可即時列印
- 常見用途：
  - 櫃台交易
  - POS 開立

> ⚠️ 使用前提：系統需具備完整發票號治理能力。

---

### 情境 B｜訂單版（Order-based）

**一句話說明**：
> 先有訂單，再由 e首發票協助取號並開立發票。

- 取號責任：e首發票
- 特點：
  - 可依訂單狀態決定開票時機
  - 適合取消、退貨、延遲出貨
- 常見用途：
  - 電商平台
  - 訂單管理系統

---

### 情境 C｜平台整合型（Webhook / 排程）

**一句話說明**：
> 平台通知訂單狀態，e首發票依治理規則排程開立。

- 取號責任：e首發票
- 特點：
  - 非即時
  - 強調避免跨期
- 常見用途：
  - Shopee
  - WooCommerce
  - 91APP

---

### 情境 D｜第三方轉入後補開

**一句話說明**：
> 原始交易非由 e首發票開立，後續補合法發票。

- 取號責任：e首發票（轉換後）
- 特點：
  - 需人工或條件觸發
  - 有上傳時效限制
- 常見用途：
  - 第三方金流
  - 未簽約平台

---

### 情境 E｜人工／EXCEL 補登

**一句話說明**：
> 非即時或異常情境下的補開方式。

- 取號責任：視設定
- 特點：
  - 多用於異常或停機期間
- 常見用途：
  - 補單
  - 人工修正

---

### 情境 F｜機台／繳款設備（Device-based）

**一句話說明**：
> 以機台號作為交易追蹤單位的簡化開立模式。

- 取號責任：e首發票
- 特點：
  - 不以人或訂單為主體
  - 每台設備需有唯一機台號
- 常見用途：
  - 食品販賣機
  - 繳費機

---

## 四、混合使用的重要提醒

> 若同一營業人同時使用多個情境（例如 ERP + 電商 + 機台），**必須搭配切本配號管理**，以避免重號與責任不明。

請參考：
- `docs/rules/einv/invoice-issuance-and-numbering.md`

---

## 五、治理結論

> API 的差異不是功能，而是**責任歸屬與風險治理的選擇**。
> 
> 在不確定情境時，請優先選擇「由 e首發票協助取號」的模式，以降低合規風險。
